<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìµœì¢… íŒê²° - ë‚´íƒ“ë„¤íƒ“</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        body { margin: 0; background-color: #f0f0f0; font-family: 'Pretendard', sans-serif; color: #333; }
        .mobile-container {
            width: 100%; max-width: 430px; margin: 0 auto; min-height: 100vh;
            display: flex; flex-direction: column; align-items: center; padding: 40px 20px; box-sizing: border-box;
        }

        /* ê³µìœ ë  ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        #resultCard {
            width: 100%; background: #ffffff; border-radius: 20px; padding: 30px 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); box-sizing: border-box;
            position: relative; overflow: hidden; border: 2px solid #333;
        }

        .card-header { text-align: center; font-size: 14px; font-weight: bold; color: #b8860b; margin-bottom: 10px; }
        .case-title { text-align: center; font-size: 20px; font-weight: 800; margin-bottom: 25px; line-height: 1.4; }

        /* ê·¸ë˜í”„ ì˜ì—­ */
        .vote-container { margin-bottom: 30px; }
        .vote-labels { display: flex; justify-content: space-between; font-size: 14px; font-weight: bold; margin-bottom: 8px; }
        .vote-bar-bg { width: 100%; height: 35px; background: #eee; border-radius: 10px; display: flex; overflow: hidden; }
        .bar-my { background: #ff4d4d; color: white; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: bold; transition: 1s; }
        .bar-your { background: #4d79ff; color: white; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: bold; transition: 1s; }

        /* ê²°ê³¼ ë¬¸êµ¬ */
        .verdict-box {
            text-align: center; background: #333; color: white; padding: 20px 15px;
            border-radius: 12px; font-size: 18px; font-weight: bold; margin-bottom: 25px;
            line-height: 1.5;
        }
        .white-text { color: white; } /* [2026-01-29] ê°•ì¡°ìƒ‰ ì ìš© */

        .best-comment-box {
            background: #f9f9f9; border-left: 4px solid #b8860b; padding: 15px; font-size: 14px; line-height: 1.6;
        }
        .comment-label { font-size: 12px; color: #888; font-weight: bold; margin-bottom: 5px; }

        /* í•˜ë‹¨ ë²„íŠ¼ */
        .action-area { width: 100%; margin-top: 30px; display: flex; flex-direction: column; gap: 10px; }
        .btn {
            width: 100%; height: 55px; border-radius: 12px; border: none; font-size: 16px; font-weight: bold; cursor: pointer;
        }
        .btn-share { background: #333; color: white; } /* ê³µìœ í•˜ê¸° ë²„íŠ¼ */
        .btn-save { background: #b8860b; color: white; }
        .btn-home { background: #eee; color: #333; }
    </style>
</head>
<body>
    <div class="mobile-container">
        <div id="resultCard">
            <div class="card-header">FINAL VERDICT REPORT</div>
            <div id="displayTitle" class="case-title">ì‚¬ê±´ ì œëª©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            
            <div class="vote-container">
                <div class="vote-labels">
                    <span>ë‚´ íƒ“</span>
                    <span>ë„¤ íƒ“</span>
                </div>
                <div class="vote-bar-bg">
                    <div id="barMy" class="bar-my" style="width: 50%">0%</div>
                    <div id="barYour" class="bar-your" style="width: 50%">0%</div>
                </div>
            </div>

            <div class="verdict-box">
                ë°°ì‹¬ì›ë‹¨ ìµœì¢… íŒê²°: <br>
                <span id="finalVerdict" class="white-text">ë¶„ì„ ì¤‘...</span>
            </div>

            <div class="best-comment-box">
                <div class="comment-label">BEST JURY COMMENT</div>
                <div id="bestCommentText">ê°€ì¥ ê³µê°ì„ ë§ì´ ë°›ì€ í‰ê²°ì´ ì´ê³³ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
            </div>
        </div>

        <div class="action-area">
            <button class="btn btn-share" onclick="shareResult()">ğŸ“¤ ì¹œêµ¬ì—ê²Œ ê³µìœ í•˜ê³  50ì½”ì¸ ë°›ê¸°</button>
            <button class="btn btn-save" onclick="downloadResult()">ğŸ“¸ íŒê²°ë¬¸ ì´ë¯¸ì§€ë¡œ ì €ì¥í•˜ê¸°</button>
            <button class="btn btn-home" onclick="location.href='index.html'">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
    </div>

    <script>
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const caseId = urlParams.get('id');
            const savedCases = JSON.parse(localStorage.getItem('myCases') || '[]');
            
            const targetCase = savedCases.find(c => c.id == caseId);

            if (targetCase) {
                const myVotes = targetCase.voteCount.my || 0;
                const yourVotes = targetCase.voteCount.your || 0;
                const total = myVotes + yourVotes || 1;

                const myPercent = Math.round((myVotes / total) * 100);
                const yourPercent = 100 - myPercent;

                document.getElementById('displayTitle').innerText = `"${targetCase.title}"`;
                document.getElementById('barMy').style.width = myPercent + '%';
                document.getElementById('barMy').innerText = myPercent + '%';
                document.getElementById('barYour').style.width = yourPercent + '%';
                document.getElementById('barYour').innerText = yourPercent + '%';

                // --- [ë‚´ íƒ“ ë¹„ìœ¨ë³„ í’ì ë¬¸êµ¬ ì„¤ì •] ---
                const verdictSpan = document.getElementById('finalVerdict');
                let message = "";

                if (myPercent < 50) {
                    message = "ê±°ë´, ë‚´ ì˜ëª» ì•„ë‹ˆë¼ê³  í–ˆì§€? ğŸ˜";
                } else if (myPercent >= 50 && myPercent < 55) {
                    message = "í .. ì˜ì˜ëª»ì„ ë”°ì§€ê¸° ì°¸ ì• ë§¤í•˜ë„¤ìš”. ë„ê¸´ê°œê¸´?";
                } else if (myPercent >= 55 && myPercent < 65) {
                    message = "í¬ê²Œ ì˜ëª»í•œ ê±´ ì•„ë‹ˆì§€ë§Œ.. ì†”ì§íˆ ë‹˜ ì˜ëª»ì´ ë§ê¸´ í•œ ë“¯? ğŸ¤”";
                } else if (myPercent >= 65 && myPercent < 75) {
                    message = "ì´ ì •ë„ë©´ ë³¸ì¸ë„ ì•Œ í…ë°? ìŠ¬ìŠ¬ ì–‘ì‹¬ì´ ì°”ë¦´ ì‹œê°„ì…ë‹ˆë‹¤.";
                } else if (myPercent >= 75 && myPercent < 85) {
                    message = "ì™€.. ì‹¤í™”ì¸ê°€ìš”? ë°°ì‹¬ì› ëŒ€ë‹¤ìˆ˜ê°€ ë‹˜ íƒ“ì´ë¼ê³  ì†Œë¦¬ ì§€ë¥´ëŠ” ì¤‘!";
                } else {
                    message = "ë‚¨ íƒ“ ì§€ë¦¬êµ¬ìš”~ ì´ ì •ë„ë©´ ê±°ì˜ ì˜ˆìˆ  ì ìˆ˜ ë“œë ¤ì•¼ í•  íŒ ğŸ‘";
                }

                verdictSpan.innerText = message;

                if (targetCase.comments && targetCase.comments.length > 0) {
                    document.getElementById('bestCommentText').innerText = targetCase.comments[0].text;
                }
            }
        };

        // ì½”ì¸ ì§€ê¸‰ ë¡œì§
        function awardCoin(amount) {
            let userData = JSON.parse(localStorage.getItem('userData')) || { coin: 0 };
            userData.coin += amount;
            localStorage.setItem('userData', JSON.stringify(userData));
            alert(`ğŸª™ ê³µìœ  ë³´ìƒìœ¼ë¡œ ê¸ˆìƒ‰ ì½”ì¸ ${amount}ê°œê°€ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤!`);
        }

        // ì´ë¯¸ì§€ íŒŒì¼ë¡œ ê³µìœ í•˜ëŠ” ê¸°ëŠ¥
        async function shareResult() {
            const card = document.getElementById('resultCard');
            const canvas = await html2canvas(card, { scale: 2 });
            const dataUrl = canvas.toDataURL('image/png');
            
            const response = await fetch(dataUrl);
            const blob = await response.blob();
            const file = new File([blob], 'verdict_result.png', { type: 'image/png' });

            if (navigator.canShare && navigator.canShare({ files: [file] })) {
                try {
                    await navigator.share({
                        files: [file],
                        title: 'ë‚´íƒ“ë„¤íƒ“ íŒê²° ê²°ê³¼',
                        text: 'ì´ íŒê²° ê²°ê³¼ ì¢€ ë´ì£¼ì„¸ìš”!'
                    });
                    // ê³µìœ  ì°½ì´ ì„±ê³µì ìœ¼ë¡œ í˜¸ì¶œë˜ë©´ ì½”ê¸‰ ì§€ê¸‰
                    awardCoin(50);
                } catch (err) { 
                    console.log("ê³µìœ  ì·¨ì†Œ ë˜ëŠ” ì‹¤íŒ¨:", err); 
                }
            } else {
                alert("í˜„ì¬ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ê³µìœ í•˜ê¸°ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ ì €ì¥ ê¸°ëŠ¥ì„ ì´ìš©í•´ì£¼ì„¸ìš”!");
            }
        }

        // ì´ë¯¸ì§€ íŒŒì¼ë¡œ ì €ì¥í•˜ëŠ” ê¸°ëŠ¥
        function downloadResult() {
            const card = document.getElementById('resultCard');
            html2canvas(card, { scale: 2, backgroundColor: "#ffffff" }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'ë‚´íƒ“ë„¤íƒ“_íŒê²°ë³´ê³ ì„œ.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
                alert("íŒê²°ë¬¸ ì´ë¯¸ì§€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
            });
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ê±´ ì ‘ìˆ˜ - ë‚´íƒ“ë„¤íƒ“</title>
    <style>
        body { 
            margin: 0; 
            background-color: #ffffff; 
            font-family: 'Pretendard', sans-serif; 
            color: #333333; 
        }
        .mobile-container {
            width: 100%; max-width: 430px; min-height: 100vh; margin: 0 auto;
            display: flex; flex-direction: column; padding: 60px 20px; box-sizing: border-box;
            background-color: #ffffff;
        }
        .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 30px; }
        .back-btn { font-size: 28px; color: #333; text-decoration: none; font-weight: bold; cursor: pointer; border: none; background: none; padding: 0; }
        .my-coin-status {
            background: #f8f9fa; padding: 8px 15px; border-radius: 20px;
            border: 1px solid #eeeeee; font-size: 14px; display: flex; align-items: center; gap: 8px;
        }
        .form-group { margin-bottom: 20px; }
        label { display: block; font-size: 14px; margin-bottom: 8px; color: #555; font-weight: bold; }
        input, textarea {
            width: 100%; background: #ffffff; border: 1px solid #dddddd;
            border-radius: 12px; padding: 15px; color: #333; box-sizing: border-box; font-size: 16px;
        }
        input::placeholder, textarea::placeholder { color: #aaaaaa; }
        textarea { height: 200px; resize: none; }
        .time-options { display: flex; gap: 10px; }
        .time-options label { flex: 1; margin: 0; }
        .time-options input { display: none; }
        .time-box {
            background: #f1f1f1; border: 1px solid #dddddd;
            padding: 12px; border-radius: 10px; text-align: center; cursor: pointer; color: #666;
        }
        input:checked + .time-box {
            background: #333; border-color: #333; color: white; font-weight: bold;
        }
        .submit-btn {
            width: 100%; background: #ff4d4d; color: white; border: none; padding: 18px;
            border-radius: 15px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 20px;
        }
        .coin-info { text-align: center; font-size: 13px; color: #666; margin-top: 15px; }
        .highlight-text { color: white; background-color: #333; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="mobile-container">
        <div class="header">
            <button onclick="location.href='main.html'" class="back-btn">â€¹</button>
            <div class="my-coin-status">
                <span style="color: #b8860b;">ğŸŸ¡ ê¸ˆìƒ‰ ì½”ì¸ ë³´ìœ ëŸ‰</span>
                <span id="currentGold" style="font-weight: bold; color: #333;">0</span>
            </div>
        </div>

        <div class="form-group">
            <label>ì‚¬ê±´ ì œëª© (ìµœëŒ€ 15ì)</label>
            <input type="text" id="caseTitle" maxlength="15" placeholder="ì œëª© (ìµœëŒ€ 15ì)">
        </div>

        <div class="form-group">
            <label>ìƒì„¸ ë‚´ìš© (ìµœëŒ€ 1200ì)</label>
            <textarea id="caseContent" maxlength="1200" placeholder="ì‚¬ê±´ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš” (ìµœëŒ€ 1200ì)"></textarea>
        </div>

        <div class="form-group">
            <label>íŒê²° ì œí•œ ì‹œê°„</label>
            <div class="time-options">
                <label><input type="radio" name="limitTime" value="5" checked><div class="time-box">5ë¶„</div></label>
                <label><input type="radio" name="limitTime" value="30"><div class="time-box">30ë¶„</div></label>
                <label><input type="radio" name="limitTime" value="60"><div class="time-box">1ì‹œê°„</div></label>
            </div>
        </div>

        <button class="submit-btn" onclick="saveCase()">ì¬íŒ ì‹œì‘í•˜ê¸° (ğŸŸ¡100)</button>
        <p class="coin-info">ì‚¬ê±´ ì ‘ìˆ˜ ì‹œ <span class="highlight-text">ê¸ˆìƒ‰ ì½”ì¸ 100ê°œ</span>ê°€ ì†Œëª¨ë©ë‹ˆë‹¤.</p>
    </div>

    <script>
        if (!localStorage.getItem('currentUser')) {
            location.replace('main.html');
        }

        function getUserCoinData() {
            const userData = JSON.parse(localStorage.getItem('userData')) || { coin: 0 };
            return userData;
        }

        function updateCoinDisplay() {
            const userData = getUserCoinData();
            document.getElementById('currentGold').innerText = (userData.coin || 0).toLocaleString();
        }

        function saveCase() {
            const title = document.getElementById('caseTitle').value;
            const content = document.getElementById('caseContent').value;
            const minutes = document.querySelector('input[name="limitTime"]:checked').value;
            
            const allUsers = JSON.parse(localStorage.getItem('registeredUsers') || '{}');
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            let userData = JSON.parse(localStorage.getItem('userData')) || { coin: 0 };

            if (!currentUser) {
                alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
                return;
            }

            const cases = JSON.parse(localStorage.getItem('myCases') || '[]');
            const now = Date.now();
            const ongoingCase = cases.find(item => item.authorName === currentUser.nickname && item.endTime > now);

            if (ongoingCase) {
                const remainingMin = Math.ceil((ongoingCase.endTime - now) / 60000);
                alert(`í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ì¬íŒì´ ìˆìŠµë‹ˆë‹¤.\níŒê²° ì¢…ë£Œê¹Œì§€ ì•½ ${remainingMin}ë¶„ ë‚¨ì•˜ìŠµë‹ˆë‹¤.`);
                return;
            }

            if (userData.coin < 100) {
                alert("ê¸ˆìƒ‰ ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤! (í•„ìš”: 100ê°œ)");
                return;
            }

            if (!title.trim() || !content.trim()) {
                alert("ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            userData.coin -= 100;
            localStorage.setItem('userData', JSON.stringify(userData));

            allUsers[currentUser.userId] = currentUser; 
            localStorage.setItem('registeredUsers', JSON.stringify(allUsers));

            cases.unshift({
                id: Date.now(),
                authorName: currentUser.nickname,
                title: title,
                content: content,
                endTime: Date.now() + (minutes * 60 * 1000),
                likes: 0,
                voteCount: { my: 0, your: 0 },
                comments: [],
                voted: false,
                isMine: true
            });
            localStorage.setItem('myCases', JSON.stringify(cases));

            alert("ì‚¬ê±´ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤! ê¸ˆìƒ‰ ì½”ì¸ 100ê°œê°€ ì‚¬ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.");
            location.href = 'list.html';
        }

        updateCoinDisplay();
    </script>
</body>
</html>